sudo: false
language: python
cache:
    directories:
      - $HOME/.mimic-cache
      - $HOME/.cache/pip
      - $HOME/Library/Caches/pip

matrix:
    include:
        - python: 2.7
          env: TOXENV=py27
        - python: 3.4
          env: TOXENV=py34
        - python: 3.5
          env: TOXENV=py35
        - python: pypy
          env: TOXENV=pypy
        - python: 2.7
          env: TOXENV=docs
        - python: 2.7
          env: TOXENV=docs-spellcheck
          addons:
              apt:
                  packages:
                      - libenchant-dev
        - python: 2.7
          env: TOXENV=docs-linkcheck
        - python: 2.7
          env: TOXENV=lint
        - language: generic
          os: osx
          osx_image: xcode7.2
          env: TOXENV=py27
        - language: generic
          os: osx
          osx_image: xcode7.2
          env: TOXENV=pypy
        - language: c
          os: osx
          osx_image: xcode7.2
          env: MACAPP_ENV=system
    allow_failures:
      - env: TOXENV=docs-linkcheck

install:
  - travis_retry ./.travis/install.sh

script:
  - ./.travis/run.sh

after_success:
  - "source ~/.venv/bin/activate && coverage combine && codecov"

notifications:
  irc:
     channels: "chat.freenode.net##mimic"
     template:
       - "%{repository}@%{branch} - %{author}: %{message} (%{build_url})"
     use_notice: true

branches:
  only:
    - master
    - gh-pages
